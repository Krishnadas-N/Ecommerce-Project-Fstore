<%- include('partials/Adminheader') %>
<style>
     /* Custom CSS for the centered and smaller modal */
    .btn-edit{
        display: flex;
    }
     .actives {
        display: inline-block;
        padding: 2px 5px;
        background-color: green;
        color: white;
        border-radius: 3px;
    }

    /* Styles for Inactive */
    .inactive {
        display: inline-block;
        padding: 2px 5px;
        background-color: red;
        color: white;
        border-radius: 3px;
    }
     .receipt-modal {
        text-align: center;
    }
    
    .receipt {
        text-align: left;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    #generateCodeContainer {
        display: inline-block;
        cursor: pointer; /* Make it appear clickable */
        text-decoration: underline; /* Make the text look like a link */
        font-weight: normal; /* Remove button's bold text style */
        background: none; /* Remove background color */
        border: none; /* Remove border */
        padding: 0; /* Remove padding */
        margin: 0; /* Remove margin */
    }
    .custom-toast {
        position: fixed;
        top: 0;
        right: 0;
        z-index: 1000; /* Adjust the z-index to your needs */
        display: none;
    }
    
    .toast-content {
        background-color: #f44336; /* Customize the background color */
        color: #fff; /* Customize the text color */
        border-radius: 6px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        margin: 10px;
        max-width: 300px;
    }
    
    .toast-header {
        padding: 10px;
        display: flex;
        justify-content: space-between;
    }
    
    .toast-title {
        font-weight: bold;
    }
    
    .toast-close {
        background: none;
        border: none;
        color: inherit;
        cursor: pointer;
        font-size: 16px;
    }
    
    .toast-body {
        padding: 10px;
    }
    #notification-bar {
        display: none;
        position: fixed;
        z-index: 999;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 300px;
        height: 60px;
        display: flex;
        justify-content: center; /* Center the content horizontally */
        align-items: center; /* Center the content vertically */
        background-color: #F4E0E1;
        color: #A42732;
        border-radius: 4px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
      }
      
      #notification-bar.visible {
        display: block;
        transform: translateX(-50%) translateY(20px);
        transition: transform 0.3s ease;
      }
      
      #notification-icon {
        width: 30px; /* Adjust the size of the icon */
        height: 30px; /* Adjust the size of the icon */
        margin-right: 10px;
      }
      
      
      /* Styles for success message */
      .success-message {
        background-color: #A9DFBF;
        color: #196F3D;
      }
      
      /* Styles for error message */
      .error-message {
        background-color: #F4E0E1;
        color: #A42732;
      }
      
      .message-box {
        position: fixed;
        top: 4%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: #fff;
        text-align: center;
        padding: 10px;
        border-radius: 5px;
        display: none;
    }

    /* CSS for success and error classes */
    .success {
        background-color: #4CAF50;
    }

    .error {
        background-color: #f44336;
    }

    /* CSS for the icon */
    .message-icon {
        display: inline-block;
        margin-right: 5px;
    }
      
    
</style>
<div class="page-wrapper">
<%- include('partials/Adminnav',{dashboard:false}) %>





<div class="main-container">

    <!-- //popups -->
    <div id="alertContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 5"></div>

    <!-- <div id="notification-bar" class="hidden">
        <div class="notification-message">
          <div id="notification-icon"></div>
          <div id="notification-text"></div>
        </div>
      </div>
      
       -->
       <div class="message-box" id="messageBox"></div>
   
    <%- include('partials/adminPageHeader',{dashboard:false,searchFormAction:'#'}) %>
    <div class="row m-3">
        <div class="row d-flex justify-content-end mb-4">
    <button type="button" class="btn btn-primary create-coupon-btn w-25" data-toggle="modal" data-target="#createCouponModal">
        Create Coupon
    </button>
          </div>
          
    <table class="table table-bordered table-definition mb-5">
        <thead class="table-warning ">
            <tr>
                <th>S.No</th>
                <th>Coupon Name</th>
                <th>Description</th>
                <th>Discount Percentage</th>
               <th>Maximum DiscountAmount</th>
                <th>Minimum Amount</th>
                <th>Maximum amount</th>
                <th>Status</th>
                <th>View </th>
                <th col-2>Actions</th>
              
            </tr>
        </thead>
        <tbody>
            <% if(coupons && coupons.length>0){ %>
                <% coupons.forEach((item,i)=>{%>
            <tr>
                <td class="text-center mt-2"><%= i+1  %></td>
                <td class="text-center mt-2">
               <%= item.code  %>
                </td>
                <td class="text-center mt-2"><%= item.description  %></td>
                <td class="text-center mt-2"><%= item.discountPercentage  %> %</td>
                <td class="text-center mt-2"><%= item.maxDiscountAmount  %> </td>
                <td class="text-center mt-2"><%= item.minimumAmount  %></td>
                <td class="text-center mt-2"><%= item.maximumAmount  %></td>
               
              
                <td class="text-center mt-2"><span class="<%= item.isActive ? 'actives' : 'inactive' %>">
                    <%= item.isActive ? 'Active' : 'Inactive' %>
                </span></td>
                <td class="text-center mt-2">
                    <button class="btn btn-sm btn-secondary" data-toggle="modal" data-target="#couponDetailsModal<%= i %>">
                        <i class="bi bi-three-dots"></i> 
                    </button>
                    
                    
                </td>
                <td class="text-center mt-2">
                    <% if (item.isActive) { %>
                        <button class="btn btn-sm btn-danger" onclick="toggleActivation('<%= item._id %>', false)" data-toggle="tooltip" title="Deactivate">
                            <i class="bi bi-toggle-off"></i>
                        </button>
                    <% } else { %>
                        <button class="btn btn-sm btn-success" onclick="toggleActivation('<%= item._id %>', true)" data-toggle="tooltip" title="Activate">
                            <i class="bi bi-toggle-on"></i>
                        </button>
                    <% } %>
                    
                    <button class="btn btn-sm btn-info" data-toggle="modal" data-target="#editCouponModal<%= item._id %>" data-toggle="tooltip" title="Edit" onclick="populateEditModal('<%= item._id %>');"> <!-- Pass the item data to populateEditModal -->
                        <i class="bi bi-pencil"></i>
                    </button>
                    
                
                                <!-- Edit Modal -->
                                <div class="modal fade" id="editCouponModal<%= item._id %>" tabindex="-1" role="dialog" aria-labelledby="editCouponModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="createCouponModalLabel">Edit Coupon</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <!-- Coupon Creation Form -->
                                                <form id="createCouponForm_<%= item._id  %>" action="/admin/EditCoupon/<%= item._id  %>" method="post">
                                                    <div class="form-row d-flex mb-3">
                                                        <div class="form-group col-md-6">
                                                            <label for="code" class="text-right">Coupon Code</label>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            
                                                            <input type="text" value="<%= item.code %>" class="form-control" id="code_<%= item._id %>" name="code" required>
                                                            <span id="codeError_<%= item._id %>" class="error-message text-danger"></span>
                                                        </div>
                                                        
                                                    </div>
                                                    
                                                    <div class="form-row d-flex mb-3">
                                                        <div class="form-group col-md-6">
                                                            <label for="description_<%= item._id %>" class="text-right">Description</label>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <textarea class="form-control" value="<%= item.description %>" id="description_<%= item._id %>" name="description" required></textarea>
                                                            <span id="descriptionError_<%= item._id %>" class="error-message text-danger"></span>
                                                        </div>
                                                    </div>
                                                    <div class="form-row d-flex mb-3">
                                                        <div class="form-group col-md-6">
                                                            <label for="maxDiscountAmount_<%= item._id %>" class="text-right">Maximum Discount Amount</label>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <input type="Number" value="<%= item.maxDiscountAmount %>" class="form-control" id="maxDiscountAmount_<%= item._id %>" name="maxDiscountAmount" required>
                                                            <span id="maxDiscountAmountError_<%= item._id %>" class="error-message text-danger"></span>
                                                        </div>
                                                    </div>
                                                    <div class="form-row d-flex mb-3">
                                                        <div class="form-group col-md-6">
                                                            <label for="discountAmount_<%= item._id %>" class="text-right">Discount Percentage</label>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <input type="text" value="<%= item.discountPercentage %>" class="form-control" id="discountAmount_<%= item._id %>" name="discountPercentage">
                                                            <span id="discountAmountError_<%= item._id %>" class="error-message text-danger"></span>
                                                        </div>
                                                    </div>
                                                    
                                                  
                                                    <div class="form-row d-flex mb-3">
                                                        <div class="form-group col-md-6">
                                                            <label for="minimumAmount_<%= item._id %>" class="text-right">Minimum Amount</label>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <input type="number" value="<%= item.minimumAmount %>" class="form-control" id="minimumAmount_<%= item._id %>" name="minimumAmount" required>
                                                            <span id="minimumAmountError_<%= item._id %>" class="error-message text-danger"></span>
                                                        </div>
                                                    </div>
                                                    <div class="form-row d-flex mb-3">
                                                        <div class="form-group col-md-6">
                                                            <label for="maximumAmount<%= item._id %>" class="text-right">Maximum Amount</label>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <input type="number" value="<%= item.maximumAmount %>" class="form-control" id="maximumAmount_<%= item._id %>" name="maximumAmount" required>
                                                            <span id="maximumAmountError_<%= item._id %>" class="error-message text-danger"></span>
                                                        </div>
                                                    </div>
                                                
                                                    <div class="form-row d-flex mb-3">
                                                        <div class="form-group col-md-6">
                                                            <label for="expirationDate_<%= item._id %>" class="text-right">Expiration Date</label>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <input type="date" value="<%= item.expirationDate %>" class="form-control" id="expirationDate_<%= item._id %>" name="expirationDate" required>
                                                            <span id="expirationDateError_<%= item._id %>" class="error-message text-danger"></span>
                                                        </div>
                                                    </div>
                                
                                                    <div class="form-row d-flex mb-3">
                                                        <div class="form-group col-md-6">
                                                            <label for="maxUsers_<%= item._id %>" class="text-right">Maximum Users Allowed</label>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <input type="number" value="<%= item.maxUsers %>" class="form-control" id="maxUsers_<%= item._id %>" name="maxUsers">
                                                            <span id="maxUsersError_<%= item._id %>" class="error-message text-danger"></span>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-primary btn-edit" onclick="populateEditModal('<%= item._id %>');" id="createCouponSubmit_<%= item._id %>">Edit</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                </td>
                
            </tr>
            <% })  %>
        <% } %>
            
        </tbody>
   
    </table>
   
</div>
<div class="row " style="position: fixed; margin-left: 30px;">
    <!-- PAGINATION -->
    <nav aria-label="..." class="d-flex justify-content-end">
      <ul class="pagination ml-auto " id="pagination">
          <% if(currentPage>1){ %>
        <li class="page-item" id="previousPage">
         <a href ="/admin/coupon-management?page=<%= currentPage-1 %>"> <span class="page-link" >Previous</span></a>
        </li>
        <% } %>
        <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= currentPage === i ? 'active' : '' %>">
            <a class="page-link" href="/admin/coupon-management?page=<%= i %>"><%= i %></a>
          </li>
        <% } %>
        <!-- Pagination links will be added dynamically here -->
      <% if(currentPage<totalPages){  %>
        <li class="page-item" id="nextPage">
          <a class="page-link" href="/admin/coupon-management?page=<%= currentPage+1 %>">Next</a>
        </li>
        <% } %>
      </ul>
    </nav> 
       
  <!-- PAGINATION Ends-->
</div>   
</div>
</div>






<!-- MODAL DETAILED VIEW  -->
<% coupons.forEach((item, i) => { %>
    <!-- Modal for Coupon Details -->
    
<div class="modal fade" id="couponDetailsModal<%= i %>" tabindex="-1" role="dialog" aria-labelledby="couponDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered receipt-modal" role="document"> <!-- Center the modal -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="couponDetailsModalLabel">Coupon Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Receipt-style formatting -->
                <div class="receipt">
                    <table class="table mx-auto table-bordered pt-4">
                        <tr class="mb-3">
                            <td class="text-center"><strong>Coupon Code:</strong></td>
                            <td class="text-center"><%= item.code %></td>
                        </tr>
                        <tr class="pt-3">
                            <td class="text-center"><strong>Description:</strong></td>
                            <td class="text-center"><%= item.description %></td>
                        </tr>
                        <tr class="mb-3">
                            <td class="text-center"><strong>Minimum Amount:</strong></td>
                            <td class="text-center"><%= item.minimumAmount %></td>
                        </tr>
                        <tr class="mb-3">
                            <td class="text-center"><strong>Maximum Amount:</strong></td>
                            <td class="text-center"><%= item.maximumAmount %></td>
                        </tr>
                        <tr class="mb-3">
                            <td class="text-center"><strong>Maximum Discount Amount:</strong></td>
                            <td class="text-center"><%= item.maxDiscountAmount %></td>
                        </tr>
                        <tr class="mb-3">
                            <td class="text-center"><strong>Discount Percentage:</strong></td>
                            <td class="text-center"><%= item.discountPercentage %> %</td>
                        </tr>
                        <tr class="mb-3">
                            <td class="text-center"><strong>Expiry Date :</strong></td>
                            <td class="text-center"><%= item.expirationDate %></td>
                        </tr>
                        <tr class="mb-3">
                            <td class="text-center"><strong>IS Active:</strong></td>
                            <td class="text-center">
                                <span class="<%= item.isActive ? 'actives' : 'inactive' %>">
                                    <%= item.isActive ? 'Active' : 'Inactive' %>
                                </span>
                            </td>
                        </tr>
                    </table>
                    
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
    
<% }) %>


<!-- Create Coupon Modal -->
<!-- Create Coupon Modal -->
<div class="modal fade" id="createCouponModal" tabindex="-1" role="dialog" aria-labelledby="createCouponModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createCouponModalLabel">Create Coupon</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Coupon Creation Form -->
                <form id="createCouponForm" action="/admin/createCoupon" method="post">
                    <div class="form-row d-flex mb-3">
                        <div class="form-group col-md-6">
                            <label for="code" class="text-right">Coupon Code</label>
                        </div>
                        <div class="form-group col-md-6">
                            <span id="generateCodeContainer">
                                <button id="generateCode" type="button">Generate Code</button>
                            </span>
                            <input type="text" class="form-control" id="code" name="code" required>
                            <span id="codeError" class="error-message text-danger"></span>
                        </div>
                        
                    </div>
                    
                    <div class="form-row d-flex mb-3">
                        <div class="form-group col-md-6">
                            <label for="description" class="text-right">Description</label>
                        </div>
                        <div class="form-group col-md-6">
                            <textarea class="form-control" id="description" name="description" required></textarea>
                            <span id="descriptionError" class="error-message text-danger"></span>
                        </div>
                    </div>
                    <div class="form-row d-flex mb-3">
                        <div class="form-group col-md-6">
                            <label for="discountAmount" class="text-right">Discount Percentage</label>
                        </div>
                        <div class="form-group col-md-6">
                            <input type="text" class="form-control" id="discountAmount" name="discountPercentage">
                            <span id="discountAmountError" class="error-message text-danger"></span>
                        </div>
                    </div>
                    
                    <div class="form-row d-flex mb-3">
                        <div class="form-group col-md-6">
                            <label for="maxDiscountAmount" class="text-right"> Maximum Discount Amount</label>
                        </div>
                        <div class="form-group col-md-6">
                            <input type="Number" class="form-control" id="maxDiscountAmount" name="maxDiscountAmount" required>
                            <span id="maxDiscountAmountError" class="error-message text-danger"></span>
                        </div>
                    </div>
                    <div class="form-row d-flex mb-3">
                        <div class="form-group col-md-6">
                            <label for="minimumAmount" class="text-right">Minimum Amount</label>
                        </div>
                        <div class="form-group col-md-6">
                            <input type="number" class="form-control" id="minimumAmount" name="minimumAmount" required>
                            <span id="minimumAmountError" class="error-message text-danger"></span>
                        </div>
                    </div>
                    <div class="form-row d-flex mb-3">
                        <div class="form-group col-md-6">
                            <label for="maximumAmount" class="text-right">Maximum Amount</label>
                        </div>
                        <div class="form-group col-md-6">
                            <input type="number" class="form-control" id="maximumAmount" name="maximumAmount" required>
                            <span id="maximumAmountError" class="error-message text-danger"></span>
                        </div>
                    </div>
                   
                    
                    <div class="form-row d-flex mb-3">
                        <div class="form-group col-md-6">
                            <label for="expirationDate" class="text-right">Expiration Date</label>
                        </div>
                        <div class="form-group col-md-6">
                            <input type="date" class="form-control" id="expirationDate" name="expirationDate" required>
                            <span id="expirationDateError" class="error-message text-danger"></span>
                        </div>
                    </div>

                    <div class="form-row d-flex mb-3">
                        <div class="form-group col-md-6">
                            <label for="maxUsers" class="text-right">Maximum Users Allowed</label>
                        </div>
                        <div class="form-group col-md-6">
                            <input type="number" class="form-control" id="maxUsers" name="maxUsers">
                            <span id="maxUsersError" class="error-message text-danger"></span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="createCouponSubmit">Create</button>
            </div>
        </div>
    </div>
</div>

<script src="/javascripts/ADMIN/AdminCouponManagement.js"></script>
<script>

 

  //Edit And Save Alert
  const successMessage = '<%= sucessMessage %>';
const errorMessage = '<%= errorMessage %>'; 

console.log('////////////////////////////////////////////////////////////')
const messageBox = document.getElementById('messageBox');

if (errorMessage !== '') {
    showMessage(errorMessage, 'error');
} else if (successMessage !== '') {
    showMessage(successMessage, 'success');
}

function showMessage(message, messageType) {
    messageBox.innerHTML = '';
    const icon = document.createElement('span');
    icon.className = 'message-icon';
    
    if (messageType === 'success') {
        icon.innerHTML = '✔'; // You can use any icon you prefer
    } else if (messageType === 'error') {
        icon.innerHTML = '✖'; // You can use any icon you prefer
    }

    messageBox.appendChild(icon);
    messageBox.appendChild(document.createTextNode(message));
    messageBox.classList.add(messageType);
    messageBox.style.display = 'block';

    setTimeout(() => {
        messageBox.style.display = 'none';
    }, 4000); // Display the message for 4 seconds
}
  
  
</script>



<%- include('partials/Adminfooter') %>